"use strict";var WPMailSMTP=window.WPMailSMTP||{};WPMailSMTP.Admin=WPMailSMTP.Admin||{},WPMailSMTP.Admin.Settings=WPMailSMTP.Admin.Settings||{},WPMailSMTP.Admin.Settings.Pro=WPMailSMTP.Admin.Settings.Pro||function(s,l){var r=function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},d={doingAjax:!1,init:function(){l(s).ready(d.ready)},ready:function(){d.pageHolder=l(".wp-mail-smtp-tab-settings"),d.bindActions()},bindActions:function(){d.license.bindActions(),d.amazonses.bindActions(),d.amazonses.loadIdentities()},license:{getNoticeHtml:function(e,t){return'<div class="notice '+e+' wp-mail-smtp-license-notice is-dismissible"><p>'+t+"</p>"},bindActions:function(){d.pageHolder.on("keydown","#wp-mail-smtp-setting-license-key",this.inputEnter),d.pageHolder.on("click","#wp-mail-smtp-setting-license-key-verify",this.verify),d.pageHolder.on("click","#wp-mail-smtp-setting-license-key-deactivate",this.deactivate),d.pageHolder.on("click","#wp-mail-smtp-setting-license-key-refresh",this.refresh)},verify:function(e){e.preventDefault();var n=jQuery(e.target),a=n.closest(".wp-mail-smtp-setting-row"),o=l("#wp-mail-smtp-setting-license-key",a),t={action:"wp_mail_smtp_pro_license_ajax",task:"license_verify",nonce:l("#wp-mail-smtp-setting-license-nonce",a).val(),license:o.val()};n.prop("disabled",!0),l.post(ajaxurl,t,function(e){var t,s,i;e.success?(t=e.data.message,s="check-circle-solid-green",i="green",a.find(".type, .desc, #wp-mail-smtp-setting-license-key-deactivate").show(),a.find(".type strong").text(e.data.type),o.prop("disabled",!0)):(t=e.data,s="exclamation-circle-regular-red",i="red",a.find(".type, .desc, #wp-mail-smtp-setting-license-key-deactivate").hide(),o.prop("disabled",!1)),d.license.displayModal(t,s,i),n.prop("disabled",!1)}).fail(function(e){console.log(e.responseText)})},inputEnter:function(e){13===e.keyCode&&(e.preventDefault(),l("#wp-mail-smtp-setting-license-key-verify").click())},deactivate:function(e){e.preventDefault();var n=jQuery(e.target),a=n.closest(".wp-mail-smtp-setting-row"),t={action:"wp_mail_smtp_pro_license_ajax",task:"license_deactivate",nonce:l("#wp-mail-smtp-setting-license-nonce",a).val()};n.prop("disabled",!0),l.post(ajaxurl,t,function(e){var t,s,i=e.data;e.success?(t="check-circle-solid-green",s="green",a.find("#wp-mail-smtp-setting-license-key").val(""),a.find(".type strong").text("lite"),a.find(".desc, #wp-mail-smtp-setting-license-key-deactivate").hide()):(t="exclamation-circle-regular-red",s="red"),l("#wp-mail-smtp-setting-license-key",a).prop("disabled",!1),d.license.displayModal(i,t,s),n.prop("disabled",!1)}).fail(function(e){console.log(e.responseText)})},refresh:function(e){e.preventDefault();var n=jQuery(e.target),a=n.closest(".wp-mail-smtp-setting-row"),t={action:"wp_mail_smtp_pro_license_ajax",task:"license_refresh",nonce:l("#wp-mail-smtp-setting-license-nonce",a).val()};n.prop("disabled",!0),l.post(ajaxurl,t,function(e){var t,s,i;e.success?(t=e.data.message,s="check-circle-solid-green",i="green",a.find(".type strong").text(e.data.type)):(t=e.data,s="exclamation-circle-regular-red",i="red",a.find(".desc, #wp-mail-smtp-setting-license-key-deactivate").hide(),l("#wp-mail-smtp-setting-license-key",a).prop("disabled",!1)),d.license.displayModal(t,s,i),n.prop("disabled",!1)}).fail(function(e){console.log(e.responseText)})},displayModal:function(e,t,s){l.alert({backgroundDismiss:!0,escapeKey:!0,animationBounce:1,theme:"modern",type:s,animateFromElement:!1,draggable:!1,closeIcon:!0,useBootstrap:!1,title:!1,icon:'"></i><img src="'+wp_mail_smtp_pro.plugin_url+"/assets/images/font-awesome/"+t+'.svg" style="width: 40px; height: 40px;" alt=""><i class="',content:e,boxWidth:"350px",buttons:{confirm:{text:wp_mail_smtp_pro.ok,btnClass:"btn-confirm",keys:["enter"]}}})}},amazonses:{bindActions:function(){l(s).on("click",".js-wp-mail-smtp-providers-amazonses-register-identity",this.processIdentityRegistration),l(s).on("change",".js-wp-mail-smtp-providers-amazonses-register-identity-radio-button",this.processIdentityTypeToggling),l(s).on("click",".js-wp-mail-smtp-providers-amazonses-txt-record button",this.processTxtCodeCopy),l(s).on("blur","#wp-mail-smtp-providers-amazonses-domain-input",function(){var e=l(this);e.val(e.val().replace("https://","").replace("http://",""))}),l(s).on("keydown","#wp-mail-smtp-providers-amazonses-domain-input, #wp-mail-smtp-providers-amazonses-email-input",function(e){13===e.which&&l(".js-wp-mail-smtp-providers-amazonses-register-identity").click()}),d.pageHolder.on("click",".js-wp-mail-smtp-providers-amazonses-register-identity-modal-button",this.openRegisterIdentityModal),d.pageHolder.on("click",".js-wp-mail-smtp-providers-amazonses-identity-delete",this.processIdentityDelete),d.pageHolder.on("click",".js-wp-mail-smtp-providers-amazonses-email-resend",this.processEmailResend),d.pageHolder.on("click",".js-wp-mail-smtp-providers-amazonses-domain-dns-record",this.displayDnsRecord),l("form",d.pageHolder).on("submit",this.maybePreventSettingsSave),l(s).on("focus",".js-wp-mail-smtp-providers-amazonses-txt-record input",function(){l(this).select()})},loadIdentities:function(){if("amazonses"===l(".js-wp-mail-smtp-setting-mailer-radio-input:checked").val()){var t=l(".js-wp-mail-smtp-ses-identities-setting"),e=t.siblings('input[name="wp_mail_smtp_pro_amazonses_load_ses_identities"]').val();void 0!==e&&e.length&&l.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_providers_ajax",task:"load_ses_identities",mailer:"amazonses",nonce:e},beforeSend:function(){d.doingAjax=!0}}).done(function(e){e.hasOwnProperty("success")&&e.success?t.html(e.data):t.html('<p class="response response-error">'+wp_mail_smtp_pro.ses_text_no_identities+"</p>")}).fail(function(){t.html('<p class="response response-error">'+wp_mail_smtp_pro.ses_text_no_identities+"</p>")}).complete(function(){d.doingAjax=!1})}},processIdentityTypeToggling:function(){var e=l(this).closest("#wp-mail-smtp-providers-amazonses-register-identity"),t=e.find("#wp-mail-smtp-providers-amazonses-domain-input"),s=e.find("#wp-mail-smtp-providers-amazonses-domain-desc"),i=e.find("#wp-mail-smtp-providers-amazonses-email-input"),n=e.find("#wp-mail-smtp-providers-amazonses-email-desc");"domain"===this.value?(t.show(),s.show(),i.hide(),n.hide()):(t.hide(),s.hide(),i.show(),n.show())},processIdentityRegistration:function(e){e.preventDefault();var t=l(e.target),s=t.closest("#wp-mail-smtp-providers-amazonses-register-identity"),i=s.find("#wp-mail-smtp-providers-amazonses-domain-input"),n=s.find("#wp-mail-smtp-providers-amazonses-email-input"),a=s.find('input[name="wp_mail_smtp_pro_amazonses_register_identity"]').val(),o=s.find('input[name="identity-type"]:checked').val(),p="email"===o?n.val():i.val();return!t.hasClass("disabled")&&("email"!==o||r(p)?void(p.length&&a.length&&l.ajax(d.amazonses.getIdentityRegistrationRequestData(o,p,a,function(){s.find("p.response").remove(),t.html(wp_mail_smtp_pro.loader_white_small).addClass("disabled with-loader"),d.doingAjax=!0})).done(function(e){e.hasOwnProperty("success")&&e.success&&(i.val(""),n.val(""),d.amazonses.loadIdentities()),s.slideUp(500,function(){s.empty().append(e.data).slideDown(300,function(){l(".js-wp-mail-smtp-btn-close").show()})})}).fail(function(){s.slideUp(500,function(){s.empty().append("<p>"+wp_mail_smtp_pro.ses_text_smth_wrong+"</p>").slideDown(300,function(){l(".js-wp-mail-smtp-btn-close").show()})})}).complete(function(){t.removeClass("disabled"),d.doingAjax=!1})):(s.find("p.response").remove(),s.append('<p class="response error">'+wp_mail_smtp_pro.ses_text_email_invalid+"</p>"),!1))},getIdentityRegistrationRequestData:function(e,t,s,i){return{url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_providers_ajax",task:"identity_registration",mailer:"amazonses",type:e,value:t,nonce:s},beforeSend:i}},openRegisterIdentityModal:function(e){e.preventDefault(),l.alert({backgroundDismiss:!1,escapeKey:!0,animationBounce:1,theme:"modern",animateFromElement:!1,draggable:!1,closeIcon:!0,useBootstrap:!1,type:"blue",boxWidth:"550px",title:wp_mail_smtp_pro.ses_add_identity_modal_title,content:wp_mail_smtp_pro.ses_add_identity_modal_content,buttons:{cancel:{text:wp_mail_smtp_pro.ses_text_close,btnClass:"js-wp-mail-smtp-btn-close btn-hide"}}})},processIdentityDelete:function(e){e.preventDefault();var t=l(e.target).closest("a"),s=t.data("identity"),i=t.data("type"),n=t.data("nonce").toString();d.amazonses.deleteIdentity(t,i,s,n)},deleteIdentity:function(e,t,s,i){l.confirm({backgroundDismiss:!1,escapeKey:!0,animationBounce:1,theme:"modern",animateFromElement:!1,draggable:!1,closeIcon:!0,useBootstrap:!1,type:"orange",boxWidth:"450px",icon:'"></i><img src="'+wp_mail_smtp_pro.plugin_url+'/assets/images/font-awesome/exclamation-circle-solid-orange.svg" style="width: 40px; height: 40px;" alt="'+wp_mail_smtp_pro.icon+'"><i class="',title:!1,content:wp_mail_smtp_pro["ses_text_"+t+"_delete"],buttons:{confirm:{text:wp_mail_smtp_pro.ses_text_yes,btnClass:"wp-mail-smtp-btn wp-mail-smtp-btn-md wp-mail-smtp-btn-orange",keys:["enter"],action:function(){d.amazonses.deleteIdentityAction(e,t,s,i)}},cancel:{text:wp_mail_smtp_pro.ses_text_cancel}}})},deleteIdentityAction:function(t,e,s,i){s.length&&i.length&&l.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_providers_ajax",task:"identity_delete",mailer:"amazonses",value:s,nonce:i},beforeSend:function(){d.doingAjax=!0}}).done(function(e){e.hasOwnProperty("success")&&e.success?t.closest("tr").fadeOut("fast",function(){this.remove()}):alert(e.data)}).fail(function(){alert(wp_mail_smtp_pro.ses_text_smth_wrong)}).complete(function(){d.doingAjax=!1})},processEmailResend:function(e){e.preventDefault();var t=l(e.target).closest("a"),s=t.data("email"),i=t.data("nonce").toString();return!t.hasClass("disabled")&&(r(s)?void(s.length&&i.length&&l.ajax(d.amazonses.getIdentityRegistrationRequestData("email",s,i,function(){t.addClass("disabled"),t.text(wp_mail_smtp_pro.ses_text_sending),d.doingAjax=!0})).done(function(e){e.hasOwnProperty("success")&&e.success?t.html('<span class="dashicons dashicons-yes"></span> '+wp_mail_smtp_pro.ses_text_sent).fadeOut(1e3,function(){l(this).text(wp_mail_smtp_pro.ses_text_resend),l(this).fadeIn("fast")}):t.html('<span class="dashicons dashicons-no"></span> '+wp_mail_smtp_pro.ses_text_resend_failed).addClass("error")}).fail(function(){alert(wp_mail_smtp_pro.ses_text_smth_wrong)}).complete(function(){t.removeClass("disabled"),d.doingAjax=!1})):(alert(wp_mail_smtp_pro.ses_text_smth_wrong),!1))},displayDnsRecord:function(e){e.preventDefault();var t=l(e.target).closest("a"),s="_amazonses."+t.data("domain"),i=t.data("txt-record");l.alert({backgroundDismiss:!0,escapeKey:!0,animationBounce:1,theme:"modern",animateFromElement:!1,draggable:!1,closeIcon:!0,useBootstrap:!1,type:"blue",boxWidth:"550px",title:wp_mail_smtp_pro.ses_text_dns_txt_title,content:wp_mail_smtp_pro.ses_text_dns_txt_content.replace(/%name%/g,s).replace(/%value%/g,i),buttons:{cancel:{keys:["enter"],text:wp_mail_smtp_pro.ses_text_close}}})},maybePreventSettingsSave:function(){if(!0===d.doingAjax)return!1},processTxtCodeCopy:function(e){e.preventDefault(),l(this).siblings("input").select(),s.execCommand("Copy");var t=l(this).find(".dashicons");t.removeClass("dashicons-admin-page").addClass("dashicons-yes-alt").fadeOut(1e3,"swing",function(){t.removeClass("dashicons-yes-alt").addClass("dashicons-admin-page").fadeIn(200)})}}};return d}(document,(window,jQuery)),WPMailSMTP.Admin.Settings.Pro.init();