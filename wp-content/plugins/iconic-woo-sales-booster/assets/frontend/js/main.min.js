jQuery(function(t){"use strict";t(document).on("change","[data-iconic-wsb-checkout-bump-trigger]",function(){var i=t("[name=iconic-wsb-checkout-bump-action]");t(this).prop("checked")?i.val("add"):i.val("remove"),t("body").trigger("update_checkout")});var i=new function(){this.isBumpShowed=!1,this.isFormSubmited=!1,this.init=function(){this.$checkoutForm=t("form.checkout"),this.container="[data-iconic-wsb-acb-modal]",this.$bumpModal=t(this.container),this.$addToCartButton=t("[data-iconic-wsb-acb-add-to-cart-button]"),this.$closeButton=t("[data-iconic-wsb-acb-close-button]"),this.actionInputSelector="[name=iconic-wsb-acb-action]",this.$form=t(".iconic-wsb-after-checkout-bump-form"),this.variation_dropdown=".iconic-wsb-checkout-modal__select",this.variationHandler=new IconicVariationHandler(this.$form,this.container,this.onVariationFound.bind(this),this.onVariationNotFound.bind(this));0<this.$bumpModal.length&&(this.$checkoutForm.on("checkout_place_order.orderBump",this.openModal.bind(this)),this.$closeButton.on("click",this.close.bind(this)),this.$addToCartButton.on("click",function(i){i.preventDefault(),this.addToCartBump()}.bind(this)),t(this.container).on("change",this.variation_dropdown,this.variationHandler.getVariation.bind(this.variationHandler)),t(".wsb_select_readonly option:not(:selected)").prop("disabled",!0)),this.$form.addClass("variations_form"),this.$form.data("product_variations",!1)},this.close=function(){t.magnificPopup.close(),this.$checkoutForm.submit()},this.addToCartBump=function(){t(this.actionInputSelector).val("add"),this.$checkoutForm.trigger("update_checkout"),this.$checkoutForm.off("checkout_place_order.orderBump",this.openModal.bind(this)),t(document).ajaxComplete(function(i,t,o){o.url.includes("update_order_review")&&!0!==this.isFormSubmited&&(this.isFormSubmited=!0,this.$checkoutForm.submit())}.bind(this)),t.magnificPopup.close()},this.openModal=function(){return!0===this.isBumpShowed||(this.variationHandler.getVariation(),t.magnificPopup.open({items:{src:this.$bumpModal,type:"inline"},modal:!0}),!(this.isBumpShowed=!0))},this.onVariationFound=function(i){this.$addToCartButton.attr("disabled",!1),this.$form.find(".iconic-wsb-checkout-modal-unavailable_msg").hide(),this.$form.find(".iconic-wsb-modal-product-offer__price").html(i.price_html),t("[name='iconic-wsb-acb-variation-id']").val(i.variation_id)},this.onVariationNotFound=function(){this.$addToCartButton.attr("disabled",!0),this.$form.find(".iconic-wsb-checkout-modal-unavailable_msg").slideDown(200),this.$form.find(".iconic-wsb-modal-product-offer__price").html(""),t("[name='iconic-wsb-acb-variation-id']").val("")}},o=new function(){this.allVariationSelectedFlag=null,this.$attributeFields=null,this.$form=t("form.woocommerce-checkout"),this.container=".iconic-wsb-checkout-bump",this.variation_dropdown=".iconic-wsb-checkout-bump__select",this.init=function(){var i=this;i.variationHandler=new IconicVariationHandler(i.$form,this.container,this.onVariationFound.bind(i),this.onVariationNotFound.bind(i)),t(i.$form).on("change",this.variation_dropdown,this.variationHandler.getVariation.bind(this.variationHandler)),t(i.$form).on("change",this.variation_dropdown,this.handleCheckbox.bind(this)),t(document.body).on("updated_checkout",function(){i.product_type=i.$form.find(".iconic-wsb-checkout-bump").data("product_type"),"variable"===i.product_type&&(i.$form.find("[name=iconic-wsb-checkout-variation-id]").length&&""===t("[name=iconic-wsb-checkout-variation-id]").val()&&i.variationHandler.getVariation(!1),i.$form.find(".iconic-wsb-checkout-bump__select").length&&i.$form.find(".iconic-wsb-checkout-bump__header-checkbox").attr("disabled",!i.variationHandler.checkAllSelects.bind(i.variationHandler)),i.handleSwatchesLabel(),i.handleOverlay(),i.handleCheckbox()),t(".wsb_select_readonly option:not(:selected)").prop("disabled",!0)}),this.$form.addClass("variations_form"),this.$form.data("product_variations",!1)},this.onVariationFound=function(i){this.$form.find("[data-iconic-wsb-checkout-bump-trigger]").attr("disabled",!1),this.$form.find(".iconic-wsb-checkou-bump_unavailable_msg").hide()},this.onVariationNotFound=function(){this.$form.find("[data-iconic-wsb-checkout-bump-trigger]").attr("disabled",!0),this.$form.find(".iconic-wsb-checkou-bump_unavailable_msg").slideDown(200)},this.handleOverlay=function(){this.$form.find("[data-iconic-wsb-checkout-bump-trigger]").prop("checked")?(this.$form.find(".iconic-wsb-checkout-bump").addClass("iconic-wsb-checkout-bump__overlay_active"),this.$form.find(".iconic-wsb-checkout-bump__overlay").show()):(this.$form.find(".iconic-wsb-checkout-bump").removeClass("iconic-wsb-checkout-bump__overlay_active"),this.$form.find(".iconic-wsb-checkout-bump__overlay").hide())},this.handleSwatchesLabel=function(){this.$form.find(".iconic-was-swatches").length&&this.$form.find(".iconic-wsb-variation__select").each(function(){var i,t,o;!jQuery(this).val()||(t=(i=jQuery(this).closest("tr")).find("td.label label .iconic-was-chosen-attribute").html())&&""===t.trim()&&(o=i.find(".iconic-was-swatch--selected").data("attribute-value-name"),i.find("td.label label .iconic-was-chosen-attribute").html(o))})},this.handleCheckbox=function(){var i=this.$form.find("[data-iconic-wsb-checkout-bump-trigger]");i.prop("checked")?i.attr("disabled",!1):this.$form.find("[data-iconic-wsb-checkout-bump-trigger]").attr("disabled",!this.variationHandler.checkAllSelects())}};t(document).ready(function(){i.init(),o.init()})}),jQuery(function(r){"use strict";var i=new function(){this.init=function(){this.$bumpModal=r("[data-iconic-wsb-acc-modal-bump]"),this.$closeButton=r("[data-iconic-wsb-close-aac-modal]"),this.$variation_wrap=jQuery(this.$bumpModal.selector+" .single_variation_wrap"),0<this.$bumpModal.length&&(this.$closeButton.on("click",this.close.bind(this)),this.$variation_wrap.on("show_variation",this.changeVariationImage),this.openModal())},this.changeVariationImage=function(i,t){var o;void 0!==t.image.thumb_src&&((o=r(this).closest("[data-iconic-wsb-acc-modal-bump-offer-product]").find("[data-iconic-wsb-acc-modal-bamp-offer-image]").find("img")).attr("srcset",""),o.attr("src",t.image.thumb_src))},this.close=function(){r.magnificPopup.close()},this.openModal=function(){r.magnificPopup.open({items:{src:this.$bumpModal,type:"inline"},modal:!0})}},t=new function(){this.init=function(){r(".variations_form").on("found_variation",this.variationChangeHandle.bind(this)),r(".iconic-wsb-bump-product__select").change(function(i){this.toggleButtonStatus.bind(this)(),this.updateTotalPrice.bind(this)(),this.fetchVariationPrice.bind(i.target)(),this.updateAttributeData.bind(i.target)()}.bind(this)),r(".iconic-wsb-bump-product__checkbox").change(function(){this.updateTotalPrice(),this.toggleButtonStatus()}.bind(this)),this.toggleButtonStatus(),this.addToCartAjax(),this.toggleProductImages(),this.disableFormSubmitForDisabledButton()},this.updateAttributeData=function(){var i=r(this).data("product_id"),t=r(this).find("option:selected").data("attributes"),o="object"==typeof t?JSON.stringify(t):t;r("[name='iconic-wsb-bump-product_attributes-"+i+"']").val(o)},this.toggleButtonStatus=function(){var t=!0;r(".iconic-wsb-product-bumps__list-item").each(function(){var i;!r(this).find(".iconic-wsb-bump-product__checkbox").prop("checked")||(i=r(this).find(".iconic-wsb-bump-product__select")).length&&!i.val()&&(t=!1)});var i=r(".iconic-wsb-bump-product__checkbox:checked").length;t&&i?r(".iconic-wsb-product-bumps__button").removeClass("disabled"):r(".iconic-wsb-product-bumps__button").addClass("disabled")},this.disableFormSubmitForDisabledButton=function(){r("form.cart").click(function(i){r(this).data("clicked",r(i.target))}),r("form.cart").submit(function(i){if(r(this).data("clicked").is("[data-bump-product-form-submit]")&&r(this).find(".iconic-wsb-product-bumps__button").hasClass("disabled"))return i.preventDefault(),!1}),r(".iconic-wsb-product-bumps__button").click(function(){r(this).hasClass("disabled")&&alert(iconic_wsb_frontend_vars.i18n.disabled_add_to_cart)})},this.fetchVariationPrice=function(){var i={action:"iconic_wsb_get_variation_price",variation_id:jQuery(this).val(),_ajax_nonce:iconic_wsb_frontend_vars.nonce},t=this;r(".variations_form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),jQuery.post(iconic_wsb_frontend_vars.ajax_url,i,function(i){r(".variations_form").unblock(),i.success&&jQuery(t).siblings(".iconic-wsb-bump-product__price").html(i.data.variation_price_html)})},this.updateTotalPrice=function(){var c=[];r(".iconic-wsb-product-bumps__list-item").each(function(){var i,t,o;r(this).find(".iconic-wsb-bump-product__checkbox").is(":checked")&&("variable"===r(this).data("product_type")?(i=parseInt(r(this).data("product_id")),o=0<(t=parseInt(r(this).find(".iconic-wsb-bump-product__select").val()))?t:i,c.push(o)):c.push(r(this).data("product_id")))});var i={action:"iconic_wsb_fbt_get_products_price",product_ids:c,offer_product_id:r("[name='iconic-wsb-fbt-this-product']").val(),_ajax_nonce:iconic_wsb_frontend_vars.nonce};r(".variations_form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),r.post(iconic_wsb_frontend_vars.ajax_url,i,function(i){r(".iconic-wsb-product-bumps__total-price-amount").html(i.html),r(".variations_form").unblock()})},this.variationChangeHandle=function(i,t){var a,n,e;this.variationId=t.variation_id,this.currentProductId=r("form.cart").data("product_id"),this.variationId&&r(".iconic-wsb-bump-product__select--"+this.currentProductId).length&&(a=r(".iconic-wsb-bump-product__select--"+this.currentProductId),n={},r("form.cart .variations select").each(function(){n[r(this).data("attribute_name")]=r(this).find("option:selected").text()}),e=0,r(".iconic-wsb-bump-product__select--"+this.currentProductId+" option").each(function(i){var t,o=r(this).data("attributes"),c=!0;for(t in n)o&&o[t]===n[t]||(c=!1);c&&(e=i,a.find("option").eq(e).prop("selected",!0),a.change())}))},this.addToCartAjax=function(){r("[data-bump-product-form-submit]").click(function(i){var o,t,c=r(this);c.prop("disabled")||c.hasClass("disabled")||"1"!==iconic_wsb_frontend_vars.fbt_use_ajax||(o=c.closest(".iconic-wsb-product-bumps"),t=c.closest("form.cart"),i.preventDefault(),o.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),c.prop("disabled",!0),r.ajax({type:"POST",url:wc_add_to_cart_params.ajax_url,data:t.serialize()+"&iconic-wsb-add-selected=1&action=iconic_wsb_fbt_add_to_cart",success:function(i){c.text(iconic_wsb_frontend_vars.i18n.success),o.unblock();var t=i.success?"woocommerce-message":"woocommerce-error";r(".woocommerce-notices-wrapper").append('<div class="'+t+'">'+i.message+"</div>"),jQuery.scroll_to_notices(r(".woocommerce-notices-wrapper")),"yes"===wc_add_to_cart_params.cart_redirect_after_add?window.location=wc_add_to_cart_params.cart_url:r(document.body).trigger("wc_fragment_refresh")},error:function(){c.text(iconic_wsb_frontend_vars.i18n.error),o.unblock()},complete:function(){setTimeout(function(){c.prop("disabled",!1).text(iconic_wsb_frontend_vars.i18n.add_selected)},3e3)}}))})},this.toggleProductImages=function(){r(".iconic-wsb-bump-product__checkbox").change(function(){var i=r(this),t=i.closest(".iconic-wsb-product-bumps__list-item"),o=i.closest(".iconic-wsb-product-bumps"),c=i.val(),a=r(".iconic-wsb-product-bumps__images"),n=r(".iconic-wsb-product-bumps__image");i.is(":checked")?(t.removeClass("iconic-wsb-product-bumps__list-item--faded"),r(".iconic-wsb-product-bumps__image[data-product-id="+c+"]").show()):(t.addClass("iconic-wsb-product-bumps__list-item--faded"),r(".iconic-wsb-product-bumps__image[data-product-id="+c+"]").hide());var e=o.find(".iconic-wsb-product-bumps__image:visible:last");n.removeClass("iconic-wsb-product-bumps__image--no-plus"),e.addClass("iconic-wsb-product-bumps__image--no-plus");var s=!a.is(":visible")||0<e.length;console.log(s),a.toggle(s)})}};r(document).ready(function(){i.init(),t.init()})});var IconicVariationHandler=function(i,t,c,a){this.$form=i,this.container_selector=t,this.getVariation=function(){var i,t=this,o=t.$form.find(".iconic-wsb__variation_id");o.length<=0||(t.checkAllSelects()?(t.$attributeFields=jQuery(t.container_selector).find(".iconic-wsb-variation__select"),i=t.getChosenAttributes().data,t.$form.hasClass("iconic-wsb-after-checkout-bump-form")?jQuery("[name='iconic-wsb-acb-variation-data']").val(JSON.stringify(i)):jQuery("[name='iconic-wsb-checkout-variation-data']").val(JSON.stringify(i)),i.product_id=parseInt(jQuery(t.container_selector).find(".iconic-wsb__product_id").val()),i.action="iconic_wsb_checkout_get_variation",i.bump_id=jQuery(t.container_selector).find(".iconic-wsb__bump_id").val(),i._ajax_nonce=iconic_wsb_frontend_vars.nonce,t.showLoader(),t.xhr=jQuery.ajax({url:iconic_wsb_frontend_vars.ajax_url,type:"POST",data:i,success:function(i){i?(t.$form.find("#iconic-wsb-checkout-bump-variation").val(i.variation_id),t.$form.find(".iconic-wsb-checkout-bump__price_span").html(i.price_html),i.is_purchasable&&i.is_in_stock&&i.variation_is_visible?(c(i),o.val(i.variation_id)):(a(),o.val(""))):(a(),o.val("")),t.hideLoader()},complete:function(){t.hideLoader()}}),t.$form.find("[data-iconic-wsb-acb-add-to-cart-button] , [data-iconic-wsb-checkout-bump-trigger]").attr("disabled",!1)):t.$form.find("[data-iconic-wsb-acb-add-to-cart-button], [data-iconic-wsb-checkout-bump-trigger]").attr("disabled",!0))},this.checkAllSelects=function(){var i=this;return i.allVariationSelectedFlag=!0,jQuery(i.container_selector).find(".iconic-wsb-variation__select").each(function(){jQuery(this).val()?jQuery(this).closest("tr").removeClass("iconic-wsb-variation-tr-valdation-error"):(i.allVariationSelectedFlag=!1,jQuery(this).closest("tr").addClass("iconic-wsb-variation-tr-valdation-error"))}),i.allVariationSelectedFlag},this.getChosenAttributes=function(){var o={},c=0,a=0;return this.$attributeFields.each(function(){var i=jQuery(this).data("attribute_name")||jQuery(this).attr("name"),t=jQuery(this).val()||"";0<t.length&&a++,c++,o[i]=t}),{count:c,chosenCount:a,data:o}},this.showLoader=function(){this.$form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},this.hideLoader=function(){this.$form.unblock()}};