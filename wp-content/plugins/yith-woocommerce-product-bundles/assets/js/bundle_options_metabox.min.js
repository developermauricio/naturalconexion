jQuery(function(a){"use strict";var t=a("select#product-type"),d=woocommerce_admin_meta_boxes.post_id,n=a("#_yith_wcpb_bundle_regular_price"),o=a("#_yith_wcpb_bundle_sale_price"),c={message:null,overlayCSS:{background:"#fff",opacity:.7}},s={el:{root:a("#yith_bundle_product_data"),add_item_btn:a("#yith-wcpb-add-bundled-product"),bundled_items:a("#yith_bundle_product_data .yith-wcpb-bundled-items"),items_count:a("#yith_bundle_product_data .yith-wcpb-bundled-items .yith-wcpb-bundled-item").size()+1,ajax_filter_products:null,expandCollapse:a("#yith-wcpb-bundled-items-expand-collapse"),actions:a("#yith-wcpb-bundled-items__actions")},init:function(){this.el.add_item_btn.on("click",this.select_products),a(document).on("click",".yith-wcpb-add-product",this.add_item),a(document).on("keyup","input.yith-wcpb-select-product-box__filter__search",this.search_filter),a(document).on("click",".yith-wcpb-remove-bundled-product-item",this.remove_current_item),a(document).on("click",".yith-wcpb-bundled-item h3 a",this.stop_event_propagation),a(document).on("click",".yith-wcpb-select-product-box__products__pagination .first:not(.disabled)",this.paginate),a(document).on("click",".yith-wcpb-select-product-box__products__pagination .prev:not(.disabled)",this.paginate),a(document).on("click",".yith-wcpb-select-product-box__products__pagination .next:not(.disabled)",this.paginate),a(document).on("click",".yith-wcpb-select-product-box__products__pagination .last:not(.disabled)",this.paginate),this.sorting(),this.bundledItemsChangeHandler()},add_item:function(){var e=a(this).data("id"),t=a(this).closest(".yith-wcpb-select-product-box__products");if(e){t.block(c);var i={action:"yith_wcpb_add_product_in_bundle",open_closed:"open",bundle_id:d,id:s.el.items_count,product_id:e,security:yith_bundle_opts.nonces.addProductToBundle};a.ajax({type:"POST",url:ajaxurl,data:i,success:function(t){t.error?alert(t.error):t.html&&(s.el.bundled_items.append(t.html),a(document.body).trigger("wc-enhanced-select-init"),a(document.body).trigger("yith-plugin-fw-init-radio"),a(document).trigger("yith-wcpb-show-conditional-init"),s.el.items_count++,s.addItemToItemsWithQty(e),s.bundledItemsChangeHandler())},complete:function(){t.unblock()}})}},remove_current_item:function(){var t=a(this).closest(".yith-wcpb-bundled-item"),e=t.data("product-id");t.remove(),s.removeItemToItemsWithQty(e),s.bundledItemsChangeHandler()},filter_products:function(t){t.s!==undefined&&t.s.length<yith_bundle_opts.minimum_characters&&(t.s=""),t=a.extend(t,{action:"yith_wcpb_select_product_box_filtered"});var i=a(".yith-wcpb-select-product-box__products");i.block(c),s.el.ajax_filter_products&&s.el.ajax_filter_products.abort(),s.el.ajax_filter_products=a.ajax({type:"POST",url:ajaxurl,data:t,success:function(t){i.html(t),s.updateAddedQuantities()},complete:function(t,e){"abort"!==e&&i.unblock(c)}})},paginate:function(){var t=a(this).data("page");if(t!==undefined){var e=a("input.yith-wcpb-select-product-box__filter__search").val();s.filter_products({s:e,page:t})}},search_filter:function(){var t=a(this).val();(!t||t.length>=yith_bundle_opts.minimum_characters)&&s.filter_products({s:t})},select_products:function(){a.fn.yith_wcpb_popup({ajax:!0,url:ajaxurl,ajax_data:{action:"yith_wcpb_select_product_box"},ajax_success:function(){a(".yith-wcpb-select-product-box__filter__search").focus(),s.updateAddedQuantities()}})},sorting:function(){var t=this.el.bundled_items.find(".yith-wcpb-bundled-item").get();t.sort(function(t,e){var i=parseInt(a(t).attr("rel")),d=parseInt(a(e).attr("rel"));return i<d?-1:d<i?1:0}),a(t).each(function(t,e){s.el.bundled_items.append(e)}),this.el.bundled_items.sortable({items:".yith-wcpb-bundled-item",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style")}})},stop_event_propagation:function(t){t.stopPropagation()},bundledItemsChangeHandler:function(){s.el.bundled_items.find(".yith-wcpb-bundled-item").length?(s.el.expandCollapse.show(),s.el.actions.removeClass("yith-wcpb-bundled-items__actions--hero")):(s.el.expandCollapse.hide(),s.el.actions.addClass("yith-wcpb-bundled-items__actions--hero")),s.updateAddedQuantities()},getItemsWithQty:function(){return s.el.root.data("items-with-qty")},setItemsWithQty:function(t){s.el.root.data("items-with-qty",t)},addItemToItemsWithQty:function(t){var e=s.getItemsWithQty();e[t]?e[t]++:e[t]=1,s.setItemsWithQty(e)},removeItemToItemsWithQty:function(t){var e=s.getItemsWithQty();e[t]?(e[t]--,e[t]||delete e[t]):e[t]=1,s.setItemsWithQty(e)},updateAddedQuantities:function(){var t=a(".yith-wcpb-select-product-box__products .yith-wcpb-select-product-box__product"),c=s.getItemsWithQty();t.each(function(t,e){var i=(e=a(e)).data("product-id"),d=c[i],n=e.find(".yith-wcpb-product-added"),o=n.find(".yith-wcpb-product-added__text");1===d?(o.html(yith_bundle_opts.i18n.addedLabelSingular),n.show()):1<d?(o.html(yith_bundle_opts.i18n.addedLabelPlural.replace("%s",d)),n.show()):n.hide()})}};s.init(),a(".pricing").addClass("hide_if_yith_bundle"),a("._manage_stock_field").addClass("show_if_yith_bundle"),a("._tax_status_field").closest("div").addClass("show_if_yith_bundle"),a("._sold_individually_field").addClass("show_if_yith_bundle").closest("div").addClass("show_if_yith_bundle"),a(".shipping_tab").addClass("yith_bundle_hide_if_non_bundled_shipping").addClass("yith_bundle_show_if_bundled_shipping"),a("body").on("woocommerce-product-type-change",function(t,e,i){"yith_bundle"===e?(n.removeAttr("disabled"),o.removeAttr("disabled"),a("input#_downloadable").prop("checked",!1),a("input#_virtual").removeAttr("checked")):(n.attr("disabled","disabled"),o.attr("disabled","disabled"))}),t.change()});