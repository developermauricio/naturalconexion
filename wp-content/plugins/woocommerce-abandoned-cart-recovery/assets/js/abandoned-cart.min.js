jQuery(document).ready(function(e){"use strict";let t="";if("undefined"==typeof wacvParams)return;const a={get(e){let t=e+"=",a=decodeURIComponent(document.cookie).split(";");for(let e=0;e<a.length;e++){let c=a[e];for(;" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(t))return c.substring(t.length,c.length)}return""},set(e,t,a=86400){var c=new Date;c.setTime(c.getTime()+1e3*a);var n="expires="+c.toUTCString();document.cookie=e+"="+t+";"+n+";path=/"}},c={checkedStt:!1,cbRender:!1,fbCbRequire:!!parseInt(wacvParams.fbCbRequire),init(){this.checkAjaxSend=!1,e("#wacv-modal").length||this.setFbCheckBox(),this.confirmOptin(),this.requireCheckbox()},setFbCheckBox(){let c=this;if(a.get("wacv_fb_checkbox"))return;if(!(parseInt(wacvParams.appID)>0&&parseInt(wacvParams.pageID)>0))return;t=Date.now();let n=`<div class='fb-messenger-checkbox' origin='${wacvParams.homeURL}' page_id='${wacvParams.pageID}' messenger_app_id='${wacvParams.appID}' user_ref='${t}'\n                        allow_login='true' size='large' ref='wacv_ref_message' skin='${wacvParams.appSkin}'></div>`;e(".fb-messenger-checkbox-container").append(n),function(e,t,a){let c,n=e.getElementsByTagName(t)[0],i=wacvParams.appLang||"en_US";e.getElementById(a)||((c=e.createElement(t)).id=a,c.src="https://connect.facebook.net/"+i+"/sdk.js",n.parentNode.insertBefore(c,n))}(document,"script","facebook-jssdk"),window.fbAsyncInit=function(){FB.init({appId:wacvParams.appID,autoLogAppEvents:!0,xfbml:!0,version:"v9.0"}),FB.Event.subscribe("messenger_checkbox",function(e){switch(e.event){case"rendered":c.cbRender=!0;break;case"checkbox":"checked"===e.state&&(c.checkedStt=!0,a.set("wacv_fb_checkbox",!0))}}),FB.getLoginStatus(function(e){"connected"===e.status||"not_authorized"===e.status||"unknown"===e.status&&(c.fbCbRequire=!1)})}},getUserRef(a){let c=this;e.ajax({url:wacvParams.ajaxUrl,type:"post",data:{action:"wacv_get_info",user_ref:t},success(e){c.checkAjaxSend=!0,a.trigger("click")}})},confirmOptin(){let a=this;e("form.cart button[type=submit], .single_add_to_cart_button, .ajax_add_to_cart").on("click",function(c){if(a.checkedStt&&!a.checkAjaxSend){let n=e(this);c.preventDefault(),c.stopImmediatePropagation(),FB.AppEvents.logEvent("MessengerCheckboxUserConfirmation",null,{app_id:wacvParams.appID,page_id:wacvParams.pageID,ref:"wacv_ref_message",user_ref:t}),a.getUserRef(n)}})},requireCheckbox(){let t=this;e("form.cart button[type=submit], .single_add_to_cart_button, .ajax_add_to_cart, .wacv-add-to-cart-btn").on("click",function(a){t.fbCbRequire&&!t.checkedStt&&t.cbRender&&(a.stopImmediatePropagation(),a.preventDefault(),e(".fb-messenger-checkbox").css({border:"1px solid red","border-radius":"5px"}))})}};c.init();const n={atcButton:"",redirectAfterATC:"",popup:"",init(){this.popup=e("#wacv-modal"),this.showPopup(),this.chooseAction(),this.afterAjaxATC()},showPopup:function(){if(!this.popup.length)return;let t=this;e("form.cart button[type=submit], .single_add_to_cart_button, .ajax_add_to_cart, .add_to_cart_button, .fw-pricing .fw-button-row a.button,.wacv-open-popup").on("mousedown",function(n){e('[tabindex="-1"]').removeAttr("tabindex"),a.get("wacv_get_email")||(n.stopImmediatePropagation(),n.preventDefault(),t.atcButton=e(this),!t.atcButton.hasClass("ajax_add_to_cart")&&wacvParams.redirect?t.atcButton.after(`<input type="hidden" name="wacv_redirect" value="${wacvParams.redirect}">`):t.redirectAfterATC=!0,t.popup.fadeIn(300),c.setFbCheckBox())})},chooseAction(){let t=this;e(".wacv-add-to-cart-btn").on("click",function(){e(".wacv-email-invalid-notice, .wacv-phone-number-invalid-notice").hide();let a=e(".wacv-popup-input-email").val(),c=e(".wacv-popup-input-phone-number").val(),n=e(".wacv-gdpr-checkbox"),i=!1;if(c=t.formatPhoneNumber(c),parseInt(wacvParams.gdprField)){n.removeClass("wacv-error"),0===e(".wacv-gdpr-checkbox:checked").length&&(n.addClass("wacv-error"),i=!0)}!t.emailValidation(a)&&parseInt(wacvParams.emailField)&&(e(".wacv-email-invalid-notice").show(),i=!0),!t.phoneValidation(c)&&parseInt(wacvParams.phoneField)&&"template-1"===wacvParams.style&&(e(".wacv-phone-number-invalid-notice").show(),i=!0),i||t.importInfo()}),e(".wacv-close-popup").on("click",function(){a.set("wacv_get_email",!0,wacvParams.dismissDelay),t.popup.fadeOut(300);let c=e._data(t.atcButton.get(0),"events"),n=!!(c&&c.click&&c.click.length>0);t.atcButton.is("a")&&!n?window.location.href=t.atcButton.attr("href"):t.atcButton.trigger("click")})},emailValidation:e=>(e=e?e.trim():e,/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)),phoneValidation:e=>/^\d{9,10}$/im.test(e),formatPhoneNumber(e){if(e){let t=(e=e.replace(/\(|\)|-|\.|\s|\+/gi,"")).slice(0,1);e=0===parseInt(t)?e.slice(1):e}return e},importInfo(){let n=this;this.popup.fadeOut(200);let i=e(".wacv-popup-input-email").val(),r=e(".wacv-country-calling-code").val(),o=n.formatPhoneNumber(e(".wacv-popup-input-phone-number").val()),s={action:"wacv_get_info",billing_email:i,billing_phone:(o=r+o)||"",status:"subscribe"};c.checkedStt&&(s.user_ref=t),e.ajax({url:wacvParams.ajaxUrl,data:s,type:"post",xhrFields:{withCredentials:!0},beforeSend:function(){e(".wacv-add-to-cart-btn").addClass("loading")},success:function(t){a.set("wacv_get_email",!0);let c=e._data(n.atcButton.get(0),"events"),i=!!(c&&c.click&&c.click.length>0);n.atcButton.is("a")&&!i?window.location.href=n.atcButton.attr("href"):n.atcButton.trigger("click")},error:function(e){}})},afterAjaxATC(){e(document).ajaxComplete(function(e,t,a){"/?wc-ajax=add_to_cart"===a.url&&!0===n.redirectAfterATC&&wacvParams.redirect?window.location.replace(wacvParams.redirect):n.showPopup()})}};n.init()});