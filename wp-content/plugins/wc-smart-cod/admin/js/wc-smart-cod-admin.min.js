jQuery(document).ready(function(e){var t=e("#mainform"),a=e(".woocommerce-save-button"),n=e(".wc-smart-cod-group"),c=e(".wc-smartcod-categories, .wc-smartcod-products"),r=e(".wc-smartcod-products.wc-smart-cod-group"),i=e(".wc-smart-cod-restriction"),s=e(".wc-smart-cod-percentage"),o=e("body"),d=e("#woocommerce_cod_restriction_settings"),l=e("#woocommerce_cod_fee_settings"),_=e(".wsc-message-switcher"),m=e(".wsc-message"),u={},h={};smart_cod_variables.hasOwnProperty("restriction_settings")&&(u=smart_cod_variables.restriction_settings),smart_cod_variables.hasOwnProperty("fee_settings")&&(h=smart_cod_variables.fee_settings);var p={init:function(){d.parents("tr").addClass("hidden"),l.parents("tr").addClass("hidden"),i.each(function(t,a){p.enableConditional(e(this))}),s.each(function(t,a){p.enablePercentage(e(this))}),o.on("change",".wc-smart-cod-percantage-switcher",p.switchFee),o.on("click",".wc-smart-cod-mode",p.switchMode),a.click(function(e){p.validateFields(n)||e.preventDefault()}),c.each(function(t,a){p.initSelect2(e(this))}),p.fixSelect2Bug(r),_.on("change",p.changeMessageVisibility)},changeMessageVisibility:function(t){e(this);var a=e(this).val();m.addClass("hidden"),e('.wsc-message[data-restriction="'+a+'"]').removeClass("hidden")},isObjectEmpty:function(e){var t;for(t in e)return!1;return!0},switchMode:function(t){t.preventDefault();var a=e(this),n=a.data("mode"),c="enable"===n?"disable":"enable",r=a.parents("tr").find(".wc-smart-cod-restriction").data("name");"enable"!==n&&"disable"!==n||(u[r]="enable"===c?1:0,d.val(JSON.stringify(u)),a.html(c),a.data("mode",c))},switchFee:function(t){var a=e(this),n=a.prev(),c=a.val(),r=n.attr("name");h[r.slice(16)]=c,l.val(JSON.stringify(h))},enablePercentage:function(t){var a=t.parents("fieldset"),n=e('<select class="wc-smart-cod-percantage-switcher"><option value="fixed">Fixed</option><option value="percentage">%</option></select>'),c="0",r=t.attr("name").slice(16);h.hasOwnProperty(r)?c=h[r]:h[r]=c="fixed",n.val(c),a.append(n)},enableConditional:function(e){var t=e.parents("tr").find("th").find("label");if(t.length>0){var a=t.contents().get(0).nodeValue,n=a.trim().split(" ");if(n[0]){var c=n[0].toLowerCase();switch(c){case"enable":case"disable":var r=e.attr("name"),i=e.data("name");t.contents().get(0).nodeValue=t.text().replace(a,""),n.shift(),t.prepend('<a class="wc-smart-cod-mode" href="#" data-mode="'+c+'" data-input-name="'+r+'">'+c+"</a> "+n.join(" ")),u.hasOwnProperty(i)||(u[i]="enable"===c?1:0)}}}},fixSelect2Bug:function(e){var t=e.data("select2");t&&t.on("results:message",function(e){this.dropdown._resizeDropdown(),this.dropdown._positionDropdown()})},initSelect2:function(t){var a,n=t.data("action")||"woocommerce_json_search_categories";"wcsmartcod_json_search_categories"===n?a=smart_cod_variables.enhanced_select.search_categories_nonce:"woocommerce_json_search_products_and_variations"===n&&(a=smart_cod_variables.enhanced_select.search_products_nonce);var c={allowClear:!!t.data("allow_clear"),placeholder:t.data("placeholder"),minimumInputLength:t.data("minimum_input_length")?t.data("minimum_input_length"):"3",escapeMarkup:function(e){return e},ajax:{url:smart_cod_variables.enhanced_select.ajax_url,dataType:"json",delay:250,data:function(e){return{term:e.term,action:n,security:a,exclude:t.data("exclude"),include:t.data("include"),limit:t.data("limit")}},processResults:function(t){var a=[];return t&&e.each(t,function(e,t){a.push({id:e,text:t})}),{results:a}},cache:!0}};c=e.extend(c,p.getEnhancedSelectFormatString()),t.select2(c).addClass("enhanced")},validateFields:function(a){t.find(".field-error").remove();return a.each(function(t,a){if("woocommerce_cod_include_restrict_postals"!==a.id&&"woocommerce_cod_restrict_postals"!==a.id)return!0;var n=e(this),c=n.val()?n.val().replace(/\s/g,""):n.val();n.val(c)}),!0},getEnhancedSelectFormatString:function(){return{language:{errorLoading:function(){return smart_cod_variables.enhanced_select.i18n_searching},inputTooLong:function(e){var t=e.input.length-e.maximum;return 1===t?smart_cod_variables.enhanced_select.i18n_input_too_long_1:smart_cod_variables.enhanced_select.i18n_input_too_long_n.replace("%qty%",t)},inputTooShort:function(e){var t=e.minimum-e.input.length;return 1===t?smart_cod_variables.enhanced_select.i18n_input_too_short_1:smart_cod_variables.enhanced_select.i18n_input_too_short_n.replace("%qty%",t)},loadingMore:function(){return smart_cod_variables.enhanced_select.i18n_load_more},maximumSelected:function(e){return 1===e.maximum?smart_cod_variables.enhanced_select.i18n_selection_too_long_1:smart_cod_variables.enhanced_select.i18n_selection_too_long_n.replace("%qty%",e.maximum)},noResults:function(){return smart_cod_variables.enhanced_select.i18n_no_matches},searching:function(){return smart_cod_variables.enhanced_select.i18n_searching}}}}};p.init()});