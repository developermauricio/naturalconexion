function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}jQuery(document).ready(function($){$.JiltPromotions={};$.JiltPromotions.InstallPluginModal=function(){function InstallPluginModal(options){_classCallCheck(this,InstallPluginModal);this.options={messageID:options.messageID||"",target:options.target||"",onClose:options.onClose||""};if(""===this.options.messageID){console.log("InstallPluginModal: missing messageID");return}if(""===this.options.target){this.options.target="sv-wc-jilt-promotions-"+this.options.messageID+"-modal"}this.initialize();this.open()}_createClass(InstallPluginModal,[{key:"initialize",value:function initialize(){var _this=this;$(document).off("click.jilt-install-modal");$(document).off("wc_backbone_modal_removed.jilt-install-modal");$(document).on("click.jilt-install-modal","#sv-wc-jilt-install-button-install",function(event){_this.onInstall(event)});$(document.body).on("wc_backbone_modal_removed.jilt-install-modal",function(event,target){if(target===_this.options.target){_this.onClose(event)}})}},{key:"open",value:function open(){$("#wc-backbone-modal-dialog .modal-close").trigger("click");new $.WCBackboneModal.View({target:this.options.target})}},{key:"onInstall",value:function onInstall(event){event.preventDefault();$("#sv-wc-jilt-install-modal .wc-backbone-modal-content").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});$.post(ajaxurl,{action:"sv_wc_jilt_install_jilt",nonce:window.sv_wc_jilt_prompt_install.nonces.install_plugin,prompt_id:this.options.messageID}).then(function(response){if(response.success&&response.data.redirect_url){window.location=response.data.redirect_url}else{console.error(response);$("#sv-wc-jilt-install-modal article").html(sv_wc_jilt_prompt_install.i18n.install_error);$("#sv-wc-jilt-install-button-install").hide()}}).fail(function(){$("#sv-wc-jilt-install-modal article").html(sv_wc_jilt_prompt_install.i18n.install_error);$("#sv-wc-jilt-install-button-install").hide()}).always(function(){$("#sv-wc-jilt-install-modal .wc-backbone-modal-content").unblock()})}},{key:"onClose",value:function onClose(event){event.preventDefault();if(this.options.onClose){$(document).trigger(this.options.onClose)}return true}}]);return InstallPluginModal}();$.JiltPromotions.Messages=function(){function Messages(){_classCallCheck(this,Messages)}_createClass(Messages,null,[{key:"enableMessage",value:function enableMessage(messageID){Messages.handleMessage(messageID,"sv_wc_jilt_enable_message",window.sv_wc_jilt_prompt_install.nonces.enable_message)}},{key:"dismissMessage",value:function dismissMessage(messageID){Messages.handleMessage(messageID,"sv_wc_jilt_dismiss_message",window.sv_wc_jilt_prompt_install.nonces.dismiss_message)}},{key:"handleMessage",value:function handleMessage(messageID,action,nonce){var data={action:action,nonce:nonce,message_id:messageID};$.post(ajaxurl,data,function(response){if(!response.success){console.error(response)}})}}]);return Messages}();$.JiltPromotions.Notice=function(){function Notice($element){_classCallCheck(this,Notice);this.$element=$element;this.messageID=$element.data("message-id");if(!this.messageID){console.log("Notice: missing data-message-id attribute");return}this.initialize()}_createClass(Notice,[{key:"initialize",value:function initialize(){var _this2=this;this.$element.off("click.jilt-promotional-notice");this.$element.on("click.jilt-promotional-notice",".sv-wc-jilt-prompt-primary-action",function(event){_this2.onInstall(event)});this.$element.on("click.jilt-promotional-notice",".notice-dismiss",function(event){_this2.onDismiss(event)})}},{key:"onInstall",value:function onInstall(event){event.preventDefault();new $.JiltPromotions.InstallPluginModal({messageID:this.messageID,target:"sv-wc-jilt-promotions-install-plugin-modal"})}},{key:"onDismiss",value:function onDismiss(event){$.JiltPromotions.Messages.dismissMessage(this.messageID)}}]);return Notice}();$(".sv-wc-jilt-promotional-notice").each(function(){new jQuery.JiltPromotions.Notice($(this))})});